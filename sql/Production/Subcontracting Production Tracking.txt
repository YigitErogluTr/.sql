WITH UretimGiris AS (     SELECT         IGN1.ItemCode,         MAX(OITM.ItemName) AS ItemName,         MAX(OITB.ItmsGrpNam) AS ItmsGrpNam,         IGN1.WhsCode,         SUM(IGN1.Quantity) AS UretimGirisMiktar     FROM IGN1     INNER JOIN OITM ON OITM.ItemCode = IGN1.ItemCode     INNER JOIN OITB ON OITB.ItmsGrpCod = OITM.ItmsGrpCod     INNER JOIN OIGN T0 ON T0.DocEntry = IGN1.DocEntry     WHERE          OITB.ItmsGrpNam IN ('MAMULLER', 'YARIMAMUL')          AND IGN1.WhsCode LIKE 'FSN%'         AND T0.DocDate BETWEEN [%0] AND [%1]     GROUP BY IGN1.ItemCode, IGN1.WhsCode ), UretimCikis AS (     SELECT         IGE1.ItemCode,         MAX(OITM.ItemName) AS ItemName,         MAX(OITB.ItmsGrpNam) AS ItmsGrpNam,         IGE1.WhsCode,         SUM(IGE1.Quantity) AS UretimCikisMiktar     FROM IGE1     INNER JOIN OITM ON OITM.ItemCode = IGE1.ItemCode     INNER JOIN OITB ON OITB.ItmsGrpCod = OITM.ItmsGrpCod     INNER JOIN OIGE T0 ON T0.DocEntry = IGE1.DocEntry     WHERE         OITB.ItmsGrpNam IN ('MAMULLER', 'YARIMAMUL')          AND IGE1.WhsCode LIKE 'FSN%'         AND T0.DocDate BETWEEN [%0] AND [%1]     GROUP BY IGE1.ItemCode, IGE1.WhsCode ), StokNakli AS (     SELECT         ItemCode,         MAX(ItemName) AS ItemName,         MAX(ItmsGrpNam) AS ItmsGrpNam,         DepoKodu,         SUM(Miktar) AS StokNakliMiktar     FROM (         SELECT             WTR1.ItemCode,             OITM.ItemName,             OITB.ItmsGrpNam,             WTR1.WhsCode AS DepoKodu,             WTR1.Quantity AS Miktar         FROM WTR1         INNER JOIN OITM ON OITM.ItemCode = WTR1.ItemCode         INNER JOIN OITB ON OITB.ItmsGrpCod = OITM.ItmsGrpCod         INNER JOIN OWTR T0 ON T0.DocEntry = WTR1.DocEntry         WHERE OITB.ItmsGrpNam IN ('MAMULLER', 'YARIMAMUL')              AND WTR1.WhsCode LIKE 'FSN%'             AND T0.DocDate BETWEEN [%0] AND [%1]          UNION ALL          SELECT             WTR1.ItemCode,             OITM.ItemName,             OITB.ItmsGrpNam,             WTR1.FromWhsCod AS DepoKodu,             -WTR1.Quantity AS Miktar         FROM WTR1         INNER JOIN OITM ON OITM.ItemCode = WTR1.ItemCode         INNER JOIN OITB ON OITB.ItmsGrpCod = OITM.ItmsGrpCod         INNER JOIN OWTR T0 ON T0.DocEntry = WTR1.DocEntry         WHERE OITB.ItmsGrpNam IN ('MAMULLER', 'YARIMAMUL')              AND WTR1.FromWhsCod LIKE 'FSN%'             AND T0.DocDate BETWEEN [%0] AND [%1]     ) AS StokNakilHareketleri     GROUP BY ItemCode, DepoKodu )  SELECT     COALESCE(giris.ItemCode, cikis.ItemCode, nakli.ItemCode) AS [Kalem Kodu],     COALESCE(giris.ItemName, cikis.ItemName, nakli.ItemName) AS [Kalem Tanımı],     COALESCE(giris.ItmsGrpNam, cikis.ItmsGrpNam, nakli.ItmsGrpNam) AS [Kalem Grubu],     COALESCE(giris.WhsCode, cikis.WhsCode, nakli.DepoKodu) AS [Depo],     ISNULL(giris.UretimGirisMiktar, 0) AS [Üretimden Giriş],     ISNULL(cikis.UretimCikisMiktar, 0) AS [Üretimden Çıkış],     ISNULL(nakli.StokNakliMiktar, 0) AS [Stok Nakli] FROM UretimGiris giris FULL OUTER JOIN UretimCikis cikis     ON giris.ItemCode = cikis.ItemCode AND giris.WhsCode = cikis.WhsCode FULL OUTER JOIN StokNakli nakli     ON COALESCE(giris.ItemCode, cikis.ItemCode) = nakli.ItemCode     AND COALESCE(giris.WhsCode, cikis.WhsCode) = nakli.DepoKodu ORDER BY [Kalem Kodu]