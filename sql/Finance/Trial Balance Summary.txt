/* SELECT * FROM OJDT T0 */  DECLARE @BASTAR DATE DECLARE @BITTAR DATE  SET @BASTAR = /* T0.RefDate */ '[%0]' SET @BITTAR = /* T0.RefDate */ '[%1]'  --SET @BASTAR = '2022-02-28' --SET @BITTAR = '2022-02-28'  SELECT * FROM ( SELECT A.Account Hesap, B.AcctName, SUM(CASE WHEN A.Debit>0 OR A.Credit<0 THEN A.Debit + -1*A.Credit ELSE -1*A.Credit+A.Debit END) [Bakiye]  FROM JDT1 A WITH(NOLOCK) LEFT OUTER JOIN OACT B WITH(NOLOCK) ON A.Account=B.AcctCode WHERE A.RefDate BETWEEN @BASTAR AND @BITTAR AND SUBSTRING(A.Account,1,3) IN ('600','601','620','623') GROUP BY A.Account, B.AcctName UNION ALL SELECT A.Account Hesap, B.AcctName, SUM(CASE WHEN A.Debit>0 OR A.Credit<0 THEN A.Debit + -1*A.Credit ELSE -1*A.Credit+A.Debit END) [Bakiye]  FROM JDT1 A WITH(NOLOCK) LEFT OUTER JOIN OACT B WITH(NOLOCK) ON A.Account=B.AcctCode WHERE A.RefDate BETWEEN @BASTAR AND @BITTAR AND A.Account LIKE '8%' GROUP BY A.Account, B.AcctName UNION ALL SELECT A.Account Hesap, B.AcctName, SUM(CASE WHEN A.Debit>0 OR A.Credit<0 THEN A.Debit + -1*A.Credit ELSE -1*A.Credit+A.Debit END) [Bakiye]  FROM JDT1 A WITH(NOLOCK) LEFT OUTER JOIN OACT B WITH(NOLOCK) ON A.Account=B.AcctCode WHERE A.RefDate BETWEEN @BASTAR AND @BITTAR AND A.Account LIKE '15%' AND A.Account NOT LIKE '158%' AND A.Account NOT LIKE '159%' GROUP BY A.Account, B.AcctName UNION ALL SELECT SUBSTRING(A.Account,1,3)Hesap, B.AcctName, SUM(CASE WHEN A.Debit>0 OR A.Credit<0 THEN A.Debit + -1*A.Credit ELSE -1*A.Credit+A.Debit END) [Bakiye]  FROM JDT1 A WITH(NOLOCK) LEFT OUTER JOIN OACT B WITH(NOLOCK) ON SUBSTRING(A.Account,1,3)=B.AcctCode WHERE A.RefDate BETWEEN @BASTAR AND @BITTAR AND SUBSTRING(A.Account,1,3) IN ('710','711','720','721','730','731') GROUP BY SUBSTRING(A.Account,1,3), B.AcctName UNION ALL SELECT A.Account Hesap, B.AcctName, SUM(CASE WHEN A.Debit>0 OR A.Credit<0 THEN A.Debit + -1*A.Credit ELSE -1*A.Credit+A.Debit END) [Bakiye]  FROM JDT1 A WITH(NOLOCK) LEFT OUTER JOIN OACT B WITH(NOLOCK) ON A.Account=B.AcctCode WHERE A.RefDate BETWEEN @BASTAR AND @BITTAR AND A.Account LIKE '373%' GROUP BY A.Account, B.AcctName ) X ORDER BY 1