WITH   T0 AS (     SELECT         YEAR(OWOR.PostDate) AS Yil,         MONTH(OWOR.PostDate) AS Ay,         OWOR.DocNum AS IsEmriNo,         OWOR.ItemCode,         OWOR.ProdName,         OWOR.CmpltQty AS UretimMiktari,         ISNULL(M.ToplamMaliyet, 0) AS ToplamUretimMaliyeti,         CASE WHEN OWOR.CmpltQty > 0 THEN ISNULL(M.ToplamMaliyet, 0) * 1.0 / OWOR.CmpltQty ELSE 0 END AS BirimUretimMaliyet     FROM OWOR     LEFT JOIN (         SELECT              IGN1.BaseRef AS IsEmriNo,             SUM(IGN1.Quantity * IGN1.Price) AS ToplamMaliyet         FROM IGN1         INNER JOIN OIGN ON OIGN.DocEntry = IGN1.DocEntry         WHERE IGN1.BaseType = 202         GROUP BY IGN1.BaseRef     ) M ON M.IsEmriNo = OWOR.DocNum     WHERE OWOR.CmpltQty > 0       AND OWOR.Status <> 'C'       AND YEAR(OWOR.PostDate) = 2025 ),  -- 2. Aylık toplam üretim miktarı T1 AS (     SELECT         YEAR(PostDate) AS Yil,         MONTH(PostDate) AS Ay,         SUM(CmpltQty) AS AylikToplamUretim     FROM OWOR     WHERE CmpltQty > 0       AND Status <> 'C'       AND YEAR(PostDate) = 2025     GROUP BY YEAR(PostDate), MONTH(PostDate) ),  -- 3. Aylık giderler (710 HARİÇ) T2 AS (     SELECT         YEAR(OJDT.RefDate) AS Yil,         MONTH(OJDT.RefDate) AS Ay,         LEFT(JDT1.Account, 3) AS HesapGrubu,         SUM(JDT1.Debit - JDT1.Credit) AS ToplamGider     FROM OJDT     INNER JOIN JDT1 ON OJDT.TransId = JDT1.TransId     WHERE YEAR(OJDT.RefDate) = 2025       AND LEFT(JDT1.Account, 3) IN ('720','730','740','750','760','770','780')     GROUP BY YEAR(OJDT.RefDate), MONTH(OJDT.RefDate), LEFT(JDT1.Account, 3) )  SELECT     T0.Yil,     T0.Ay,     T0.IsEmriNo,     T0.ItemCode,     T0.ProdName,     T0.UretimMiktari,     T0.ToplamUretimMaliyeti,     T0.BirimUretimMaliyet,     ISNULL(T1.AylikToplamUretim, 1) AS AylikToplamUretim,      -- Gider dağılımları     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '720' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_720,     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '730' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_730,     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '740' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_740,     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '750' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_750,     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '760' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_760,     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '770' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_770,     ISNULL(MAX(CASE WHEN T2.HesapGrubu = '780' THEN T2.ToplamGider ELSE 0 END), 0) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS Gider_780,      -- Toplam gider iş emrine düşen     (         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '720' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '730' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '740' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '750' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '760' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '770' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '780' THEN T2.ToplamGider ELSE 0 END), 0)     ) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS ToplamGiderIsEmri,      -- Fiili toplam maliyet     T0.ToplamUretimMaliyeti +     (         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '720' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '730' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '740' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '750' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '760' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '770' THEN T2.ToplamGider ELSE 0 END), 0) +         ISNULL(MAX(CASE WHEN T2.HesapGrubu = '780' THEN T2.ToplamGider ELSE 0 END), 0)     ) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1) AS FiiliToplamMaliyet,      -- Fiili birim maliyet     CASE WHEN T0.UretimMiktari > 0 THEN         (             T0.ToplamUretimMaliyeti +             (                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '720' THEN T2.ToplamGider ELSE 0 END), 0) +                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '730' THEN T2.ToplamGider ELSE 0 END), 0) +                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '740' THEN T2.ToplamGider ELSE 0 END), 0) +                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '750' THEN T2.ToplamGider ELSE 0 END), 0) +                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '760' THEN T2.ToplamGider ELSE 0 END), 0) +                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '770' THEN T2.ToplamGider ELSE 0 END), 0) +                 ISNULL(MAX(CASE WHEN T2.HesapGrubu = '780' THEN T2.ToplamGider ELSE 0 END), 0)             ) * T0.UretimMiktari / ISNULL(T1.AylikToplamUretim,1)         ) / T0.UretimMiktari     ELSE 0 END AS FiiliBirimMaliyet  FROM T0 LEFT JOIN T1 ON T0.Yil = T1.Yil AND T0.Ay = T1.Ay LEFT JOIN T2 ON T0.Yil = T2.Yil AND T0.Ay = T2.Ay GROUP BY     T0.Yil, T0.Ay, T0.IsEmriNo, T0.ItemCode, T0.ProdName, T0.UretimMiktari, T0.ToplamUretimMaliyeti, T0.BirimUretimMaliyet, T1.AylikToplamUretim ORDER BY     T0.Yil, T0.Ay, T0.IsEmriNo